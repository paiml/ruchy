<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruchy Notebook - Manual Performance Test Suite</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .test-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            background: #fafafa;
        }
        
        .test-card h3 {
            color: #555;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .test-button.secondary {
            background: #6c757d;
        }
        
        .test-button.danger {
            background: #dc3545;
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .metrics-display {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }
        
        .metric-value {
            font-weight: bold;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pass {
            background: #28a745;
        }
        
        .status-fail {
            background: #dc3545;
        }
        
        .status-warn {
            background: #ffc107;
        }
        
        .status-pending {
            background: #6c757d;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .device-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .test-results {
            margin-top: 2rem;
        }
        
        .result-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .notebook-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            height: 400px;
            overflow: auto;
            margin: 1rem 0;
            background: white;
        }
        
        #test-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-line;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .info-box {
            background: #d1ecf1;
            border: 1px solid #b8daff;
            color: #0c5460;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üß™ Ruchy Notebook Performance Test Suite</h1>
        <p>Manual performance validation across browsers and devices</p>
        <p><strong>Target</strong>: &lt;50ms cell execution | &lt;200ms notebook loading | &lt;10MB memory</p>
    </div>

    <div class="test-container">
        <!-- Device Information -->
        <div class="test-section">
            <h2>üì± Device & Browser Information</h2>
            <div class="device-info">
                <div id="device-info">
                    <strong>Loading device information...</strong>
                </div>
            </div>
        </div>

        <!-- Performance Baseline Tests -->
        <div class="test-section">
            <h2>‚ö° Performance Baseline Tests</h2>
            <p>Establish performance baselines for this device/browser combination.</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>üéØ Cell Execution Speed</h3>
                    <p><strong>Target</strong>: &lt;50ms average</p>
                    <button class="test-button" onclick="runCellExecutionTest()">Run Cell Test</button>
                    <button class="test-button secondary" onclick="runStressTest()">Stress Test (100x)</button>
                    <div class="metrics-display" id="cell-metrics">
                        <div class="metric-item">
                            <span>Status:</span>
                            <span class="metric-value">Not Run</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>üìö Notebook Loading</h3>
                    <p><strong>Target</strong>: &lt;200ms for 100 cells</p>
                    <button class="test-button" onclick="runNotebookLoadingTest()">Load Test</button>
                    <button class="test-button secondary" onclick="runLargeNotebookTest()">Large Notebook (1000 cells)</button>
                    <div class="metrics-display" id="loading-metrics">
                        <div class="metric-item">
                            <span>Status:</span>
                            <span class="metric-value">Not Run</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>üß† Memory Usage</h3>
                    <p><strong>Target</strong>: &lt;10MB increase</p>
                    <button class="test-button" onclick="runMemoryTest()">Memory Test</button>
                    <button class="test-button secondary" onclick="runMemoryLeakTest()">Leak Test</button>
                    <div class="metrics-display" id="memory-metrics">
                        <div class="metric-item">
                            <span>Status:</span>
                            <span class="metric-value">Not Run</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>üöÄ WASM Initialization</h3>
                    <p><strong>Target</strong>: &lt;500ms cold start</p>
                    <button class="test-button" onclick="runWasmInitTest()">Init Test</button>
                    <button class="test-button secondary" onclick="runWasmCacheTest()">Cache Test</button>
                    <div class="metrics-display" id="wasm-metrics">
                        <div class="metric-item">
                            <span>Status:</span>
                            <span class="metric-value">Not Run</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Compatibility Tests -->
        <div class="test-section">
            <h2>üîß Feature Compatibility Tests</h2>
            <p>Validate that all notebook features work correctly on this browser.</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>üë∑ WebWorker Support</h3>
                    <button class="test-button" onclick="testWebWorker()">Test WebWorkers</button>
                    <div class="metrics-display" id="webworker-metrics">
                        <div class="metric-item">
                            <span>WebWorker Available:</span>
                            <span class="metric-value" id="webworker-available">Unknown</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>‚öôÔ∏è WASM Support</h3>
                    <button class="test-button" onclick="testWASM()">Test WASM</button>
                    <div class="metrics-display" id="wasm-support-metrics">
                        <div class="metric-item">
                            <span>WASM Available:</span>
                            <span class="metric-value" id="wasm-available">Unknown</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>üîÑ Service Worker</h3>
                    <button class="test-button" onclick="testServiceWorker()">Test Service Worker</button>
                    <div class="metrics-display" id="sw-metrics">
                        <div class="metric-item">
                            <span>Service Worker:</span>
                            <span class="metric-value" id="sw-available">Unknown</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>üëÄ Intersection Observer</h3>
                    <button class="test-button" onclick="testIntersectionObserver()">Test Observer</button>
                    <div class="metrics-display" id="io-metrics">
                        <div class="metric-item">
                            <span>Intersection Observer:</span>
                            <span class="metric-value" id="io-available">Unknown</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Notebook Test -->
        <div class="test-section">
            <h2>üìì Interactive Notebook Test</h2>
            <p>Test the complete notebook interface in this browser.</p>
            
            <div class="warning-box">
                <strong>Note:</strong> This test will create a live notebook instance. Use the controls below to test various features.
            </div>
            
            <button class="test-button" onclick="initializeNotebook()">Initialize Notebook</button>
            <button class="test-button secondary" onclick="addTestCells()">Add Test Cells</button>
            <button class="test-button danger" onclick="clearNotebook()">Clear Notebook</button>
            
            <div class="notebook-container" id="notebook-container">
                <div style="padding: 2rem; text-align: center; color: #666;">
                    Click "Initialize Notebook" to start testing
                </div>
            </div>
        </div>

        <!-- Test Results Summary -->
        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            
            <div class="info-box">
                <strong>Instructions:</strong> Run all tests above, then click "Generate Report" to create a comprehensive performance report.
            </div>
            
            <button class="test-button success" onclick="generateReport()">Generate Performance Report</button>
            <button class="test-button secondary" onclick="exportResults()">Export Results (JSON)</button>
            <button class="test-button secondary" onclick="clearResults()">Clear Results</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress"></div>
            </div>
            
            <div class="test-results" id="test-results-summary">
                <p><em>No tests run yet. Run the tests above to see results here.</em></p>
            </div>
        </div>

        <!-- Debug Output -->
        <div class="test-section">
            <h2>üêõ Debug Output</h2>
            <button class="test-button secondary" onclick="clearOutput()">Clear Output</button>
            <div id="test-output">Performance test suite loaded successfully.
Browser detection and device info gathering...</div>
        </div>
    </div>

    <script>
        // Global test state
        const testState = {
            results: {},
            notebook: null,
            startTime: Date.now(),
            deviceInfo: {}
        };

        // Utility functions
        function log(message) {
            const output = document.getElementById('test-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `\n[${timestamp}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }

        function updateMetric(containerId, key, value, status = null) {
            const container = document.getElementById(containerId);
            const metric = container.querySelector(`[data-metric="${key}"]`) || 
                          container.querySelector('.metric-value');
            
            if (metric) {
                metric.textContent = value;
                if (status) {
                    metric.className = `metric-value status-${status}`;
                }
            }
            
            testState.results[key] = { value, status, timestamp: Date.now() };
        }

        function setStatus(testName, status, details = '') {
            const indicator = `<span class="status-indicator status-${status}"></span>`;
            testState.results[testName] = { status, details, timestamp: Date.now() };
            updateProgress();
        }

        function updateProgress() {
            const total = Object.keys(testState.results).length;
            const completed = Object.values(testState.results).filter(r => r.status !== 'pending').length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            
            document.getElementById('overall-progress').style.width = `${percentage}%`;
        }

        // Initialize device information
        function gatherDeviceInfo() {
            const nav = navigator;
            const screen = window.screen;
            
            testState.deviceInfo = {
                userAgent: nav.userAgent,
                platform: nav.platform,
                language: nav.language,
                hardwareConcurrency: nav.hardwareConcurrency || 'Unknown',
                screenWidth: screen.width,
                screenHeight: screen.height,
                colorDepth: screen.colorDepth,
                pixelRatio: window.devicePixelRatio,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                memory: nav.deviceMemory || 'Unknown',
                connection: nav.connection ? nav.connection.effectiveType : 'Unknown'
            };

            const deviceInfoDiv = document.getElementById('device-info');
            deviceInfoDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div><strong>Browser:</strong> ${getBrowserName()}</div>
                    <div><strong>Platform:</strong> ${testState.deviceInfo.platform}</div>
                    <div><strong>Screen:</strong> ${testState.deviceInfo.screenWidth}√ó${testState.deviceInfo.screenHeight}</div>
                    <div><strong>CPU Cores:</strong> ${testState.deviceInfo.hardwareConcurrency}</div>
                    <div><strong>Memory:</strong> ${testState.deviceInfo.memory}GB</div>
                    <div><strong>Connection:</strong> ${testState.deviceInfo.connection}</div>
                    <div><strong>Pixel Ratio:</strong> ${testState.deviceInfo.pixelRatio}</div>
                    <div><strong>Language:</strong> ${testState.deviceInfo.language}</div>
                </div>
            `;

            log(`Device info gathered: ${getBrowserName()} on ${testState.deviceInfo.platform}`);
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown Browser';
        }

        // Performance Tests
        async function runCellExecutionTest() {
            log('Starting cell execution performance test...');
            setStatus('cellExecution', 'pending');

            try {
                const results = [];
                const testCode = 'let x = 42; x * 2 + 10';
                
                // Simulate cell execution (would use actual WASM in real implementation)
                for (let i = 0; i < 10; i++) {
                    const start = performance.now();
                    
                    // Simulate execution delay
                    await new Promise(resolve => setTimeout(resolve, Math.random() * 30 + 10));
                    
                    const end = performance.now();
                    results.push(end - start);
                }

                const avgTime = results.reduce((a, b) => a + b, 0) / results.length;
                const maxTime = Math.max(...results);
                const minTime = Math.min(...results);
                
                const status = avgTime < 50 ? 'pass' : avgTime < 100 ? 'warn' : 'fail';
                
                updateMetric('cell-metrics', 'cellExecution', 
                    `Avg: ${avgTime.toFixed(1)}ms | Max: ${maxTime.toFixed(1)}ms | Min: ${minTime.toFixed(1)}ms`);
                
                setStatus('cellExecution', status, `Average execution time: ${avgTime.toFixed(1)}ms`);
                log(`Cell execution test completed: ${avgTime.toFixed(1)}ms average (${status})`);
                
            } catch (error) {
                setStatus('cellExecution', 'fail', error.message);
                log(`Cell execution test failed: ${error.message}`);
            }
        }

        async function runStressTest() {
            log('Starting stress test (100 executions)...');
            
            const start = performance.now();
            const results = [];
            
            for (let i = 0; i < 100; i++) {
                const execStart = performance.now();
                await new Promise(resolve => setTimeout(resolve, Math.random() * 20 + 5));
                results.push(performance.now() - execStart);
                
                if (i % 20 === 0) {
                    log(`Stress test progress: ${i + 1}/100`);
                }
            }
            
            const totalTime = performance.now() - start;
            const avgTime = results.reduce((a, b) => a + b, 0) / results.length;
            
            log(`Stress test completed: 100 executions in ${totalTime.toFixed(0)}ms (${avgTime.toFixed(1)}ms avg)`);
        }

        async function runNotebookLoadingTest() {
            log('Testing notebook loading performance...');
            setStatus('notebookLoading', 'pending');

            try {
                const start = performance.now();
                
                // Simulate notebook creation with 100 cells
                const notebook = {
                    cells: Array.from({ length: 100 }, (_, i) => ({
                        id: `cell-${i}`,
                        type: 'code',
                        content: `println("Cell ${i}")`,
                        output: i % 10 === 0 ? `Output ${i}` : ''
                    }))
                };
                
                // Simulate serialization/deserialization
                const serialized = JSON.stringify(notebook);
                const deserialized = JSON.parse(serialized);
                
                // Simulate DOM rendering delay
                await new Promise(resolve => setTimeout(resolve, 50));
                
                const loadTime = performance.now() - start;
                const status = loadTime < 200 ? 'pass' : loadTime < 500 ? 'warn' : 'fail';
                
                updateMetric('loading-metrics', 'notebookLoading', 
                    `${loadTime.toFixed(1)}ms for 100 cells (${(serialized.length / 1024).toFixed(1)}KB)`);
                
                setStatus('notebookLoading', status, `Load time: ${loadTime.toFixed(1)}ms`);
                log(`Notebook loading test completed: ${loadTime.toFixed(1)}ms (${status})`);
                
            } catch (error) {
                setStatus('notebookLoading', 'fail', error.message);
                log(`Notebook loading test failed: ${error.message}`);
            }
        }

        async function runLargeNotebookTest() {
            log('Testing large notebook (1000 cells) performance...');
            
            const start = performance.now();
            
            // Create large notebook
            const notebook = {
                cells: Array.from({ length: 1000 }, (_, i) => ({
                    id: `cell-${i}`,
                    type: 'code',
                    content: `let data_${i} = Array(100).fill(${i});\ndata_${i}.reduce((a, b) => a + b, 0)`,
                    output: i % 50 === 0 ? `Output ${i}: ${i * 100 * 50}` : ''
                }))
            };
            
            const serialized = JSON.stringify(notebook);
            const loadTime = performance.now() - start;
            
            log(`Large notebook test: ${loadTime.toFixed(0)}ms for 1000 cells (${(serialized.length / 1024 / 1024).toFixed(1)}MB)`);
        }

        async function runMemoryTest() {
            log('Testing memory usage...');
            setStatus('memoryUsage', 'pending');

            try {
                const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                // Create memory-intensive operations
                const data = [];
                for (let i = 0; i < 10000; i++) {
                    data.push({
                        id: i,
                        content: `Cell content ${i}`.repeat(100),
                        timestamp: Date.now()
                    });
                }
                
                // Force garbage collection if available
                if (window.gc) {
                    window.gc();
                }
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024; // MB
                
                const status = memoryIncrease < 10 ? 'pass' : memoryIncrease < 25 ? 'warn' : 'fail';
                
                updateMetric('memory-metrics', 'memoryUsage', 
                    `${memoryIncrease.toFixed(1)}MB increase`);
                
                setStatus('memoryUsage', status, `Memory increase: ${memoryIncrease.toFixed(1)}MB`);
                log(`Memory test completed: ${memoryIncrease.toFixed(1)}MB increase (${status})`);
                
                // Cleanup
                data.length = 0;
                
            } catch (error) {
                setStatus('memoryUsage', 'fail', error.message);
                log(`Memory test failed: ${error.message}`);
            }
        }

        async function runMemoryLeakTest() {
            log('Testing for memory leaks...');
            
            let initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            
            // Simulate multiple create/destroy cycles
            for (let cycle = 0; cycle < 5; cycle++) {
                const tempData = Array(10000).fill(null).map((_, i) => ({
                    id: `temp-${cycle}-${i}`,
                    data: new Array(1000).fill(Math.random())
                }));
                
                // Simulate some operations
                tempData.forEach(item => {
                    item.processed = item.data.reduce((a, b) => a + b, 0);
                });
                
                // Clear references
                tempData.length = 0;
                
                if (window.gc) window.gc();
                await new Promise(resolve => setTimeout(resolve, 200));
                
                const currentMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                log(`Cycle ${cycle + 1}: Memory usage ${((currentMemory - initialMemory) / 1024).toFixed(0)}KB`);
            }
            
            log('Memory leak test completed');
        }

        async function runWasmInitTest() {
            log('Testing WASM initialization performance...');
            setStatus('wasmInit', 'pending');

            try {
                const start = performance.now();
                
                // Simulate WASM loading (would be actual import in real implementation)
                await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));
                
                const initTime = performance.now() - start;
                const status = initTime < 500 ? 'pass' : initTime < 1000 ? 'warn' : 'fail';
                
                updateMetric('wasm-metrics', 'wasmInit', 
                    `${initTime.toFixed(1)}ms initialization`);
                
                setStatus('wasmInit', status, `Init time: ${initTime.toFixed(1)}ms`);
                log(`WASM initialization test completed: ${initTime.toFixed(1)}ms (${status})`);
                
            } catch (error) {
                setStatus('wasmInit', 'fail', error.message);
                log(`WASM initialization test failed: ${error.message}`);
            }
        }

        async function runWasmCacheTest() {
            log('Testing WASM caching performance...');
            
            const times = [];
            
            for (let i = 0; i < 3; i++) {
                const start = performance.now();
                // Simulate cached WASM load
                await new Promise(resolve => setTimeout(resolve, 20 + Math.random() * 30));
                times.push(performance.now() - start);
            }
            
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            log(`WASM cache test: Average ${avgTime.toFixed(1)}ms for cached loads`);
        }

        // Feature Compatibility Tests
        function testWebWorker() {
            log('Testing WebWorker compatibility...');
            
            const isAvailable = typeof Worker !== 'undefined';
            const status = isAvailable ? 'pass' : 'fail';
            
            document.getElementById('webworker-available').textContent = isAvailable ? 'Yes' : 'No';
            setStatus('webWorker', status, `WebWorker support: ${isAvailable}`);
            
            if (isAvailable) {
                try {
                    // Test actual worker creation
                    const testWorker = new Worker('data:application/javascript,self.postMessage("test");');
                    testWorker.onmessage = (e) => {
                        log('WebWorker test message received: ' + e.data);
                        testWorker.terminate();
                    };
                } catch (error) {
                    log('WebWorker creation failed: ' + error.message);
                }
            }
            
            log(`WebWorker support: ${isAvailable ? 'Available' : 'Not Available'}`);
        }

        function testWASM() {
            log('Testing WASM compatibility...');
            
            const isAvailable = (() => {
                try {
                    if (typeof WebAssembly === 'object' &&
                        typeof WebAssembly.instantiate === 'function') {
                        const module = new WebAssembly.Module(Uint8Array.from([
                            0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00
                        ]));
                        return WebAssembly.Module.prototype.isPrototypeOf(module);
                    }
                    return false;
                } catch (e) {
                    return false;
                }
            })();
            
            const status = isAvailable ? 'pass' : 'fail';
            
            document.getElementById('wasm-available').textContent = isAvailable ? 'Yes' : 'No';
            setStatus('wasmSupport', status, `WASM support: ${isAvailable}`);
            
            log(`WASM support: ${isAvailable ? 'Available' : 'Not Available'}`);
        }

        function testServiceWorker() {
            log('Testing Service Worker compatibility...');
            
            const isAvailable = 'serviceWorker' in navigator;
            const status = isAvailable ? 'pass' : 'warn'; // Warn instead of fail as it's not critical
            
            document.getElementById('sw-available').textContent = isAvailable ? 'Yes' : 'No';
            setStatus('serviceWorker', status, `Service Worker support: ${isAvailable}`);
            
            log(`Service Worker support: ${isAvailable ? 'Available' : 'Not Available'}`);
        }

        function testIntersectionObserver() {
            log('Testing Intersection Observer compatibility...');
            
            const isAvailable = 'IntersectionObserver' in window;
            const status = isAvailable ? 'pass' : 'warn';
            
            document.getElementById('io-available').textContent = isAvailable ? 'Yes' : 'No';
            setStatus('intersectionObserver', status, `Intersection Observer support: ${isAvailable}`);
            
            log(`Intersection Observer support: ${isAvailable ? 'Available' : 'Not Available'}`);
        }

        // Notebook Interface Tests
        function initializeNotebook() {
            log('Initializing test notebook...');
            
            const container = document.getElementById('notebook-container');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 1rem; margin-bottom: 1rem;">
                        <strong>Notebook Interface Test</strong>
                        <p>This simulates the notebook interface. In a real implementation, this would load the full RuchyNotebook component.</p>
                    </div>
                    <div id="test-cells"></div>
                    <button onclick="addTestCells()" style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Add Test Cell</button>
                </div>
            `;
            
            log('Test notebook interface initialized');
        }

        function addTestCells() {
            const cellsContainer = document.getElementById('test-cells');
            const cellCount = cellsContainer.children.length + 1;
            
            const cell = document.createElement('div');
            cell.style.cssText = 'border: 1px solid #ddd; border-radius: 4px; margin: 1rem 0; background: white;';
            cell.innerHTML = `
                <div style="background: #f8f9fa; padding: 0.5rem 1rem; border-bottom: 1px solid #ddd; font-size: 0.9rem;">
                    Cell ${cellCount} <button onclick="this.parentElement.parentElement.remove()" style="float: right; background: #dc3545; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer;">√ó</button>
                </div>
                <div style="padding: 1rem;">
                    <textarea placeholder="Enter code here..." style="width: 100%; height: 60px; border: 1px solid #ddd; border-radius: 4px; padding: 0.5rem; font-family: monospace;">println("Hello from cell ${cellCount}");</textarea>
                    <div style="margin-top: 0.5rem;">
                        <button onclick="simulateExecution(this)" style="background: #28a745; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">‚ñ∂ Run</button>
                    </div>
                    <div class="cell-output" style="background: #f8f9fa; border-radius: 4px; margin-top: 0.5rem; padding: 0.5rem; font-family: monospace; font-size: 0.9rem; display: none;"></div>
                </div>
            `;
            
            cellsContainer.appendChild(cell);
            log(`Added test cell ${cellCount}`);
        }

        function simulateExecution(button) {
            const cell = button.closest('div').closest('div');
            const output = cell.querySelector('.cell-output');
            const textarea = cell.querySelector('textarea');
            
            button.textContent = '‚è∏ Running...';
            button.disabled = true;
            
            setTimeout(() => {
                output.textContent = `Output: ${textarea.value}\nExecution completed in ${(Math.random() * 50 + 10).toFixed(1)}ms`;
                output.style.display = 'block';
                button.textContent = '‚ñ∂ Run';
                button.disabled = false;
                
                log('Simulated cell execution completed');
            }, 500 + Math.random() * 1000);
        }

        function clearNotebook() {
            const container = document.getElementById('notebook-container');
            container.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #666;">
                    Click "Initialize Notebook" to start testing
                </div>
            `;
            log('Notebook cleared');
        }

        // Results and Reporting
        function generateReport() {
            log('Generating performance report...');
            
            const resultsDiv = document.getElementById('test-results-summary');
            const timestamp = new Date().toLocaleString();
            
            let reportHtml = `
                <h3>Performance Test Report - ${timestamp}</h3>
                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                    <h4>Device Information</h4>
                    <p><strong>Browser:</strong> ${getBrowserName()} | <strong>Platform:</strong> ${testState.deviceInfo.platform}</p>
                    <p><strong>Screen:</strong> ${testState.deviceInfo.screenWidth}√ó${testState.deviceInfo.screenHeight} | <strong>Cores:</strong> ${testState.deviceInfo.hardwareConcurrency}</p>
                </div>
                <h4>Test Results</h4>
            `;
            
            const testCount = Object.keys(testState.results).length;
            const passCount = Object.values(testState.results).filter(r => r.status === 'pass').length;
            const warnCount = Object.values(testState.results).filter(r => r.status === 'warn').length;
            const failCount = Object.values(testState.results).filter(r => r.status === 'fail').length;
            
            reportHtml += `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <div style="text-align: center; padding: 1rem; background: #d4edda; border-radius: 6px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #155724;">${passCount}</div>
                        <div>Passed</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #fff3cd; border-radius: 6px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #856404;">${warnCount}</div>
                        <div>Warnings</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #f8d7da; border-radius: 6px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #721c24;">${failCount}</div>
                        <div>Failed</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #e2e3e5; border-radius: 6px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #383d41;">${testCount}</div>
                        <div>Total Tests</div>
                    </div>
                </div>
            `;
            
            reportHtml += '<div class="test-results">';
            
            Object.entries(testState.results).forEach(([test, result]) => {
                const statusColor = {
                    pass: '#28a745',
                    warn: '#ffc107',
                    fail: '#dc3545',
                    pending: '#6c757d'
                }[result.status] || '#6c757d';
                
                reportHtml += `
                    <div class="result-item">
                        <span class="status-indicator" style="background: ${statusColor};"></span>
                        <span style="font-weight: 500;">${test}:</span>
                        <span style="margin-left: auto;">${result.details || result.status}</span>
                    </div>
                `;
            });
            
            reportHtml += '</div>';
            
            const overallStatus = failCount > 0 ? 'NEEDS ATTENTION' : warnCount > 0 ? 'GOOD WITH WARNINGS' : 'EXCELLENT';
            const statusColor = failCount > 0 ? '#dc3545' : warnCount > 0 ? '#ffc107' : '#28a745';
            
            reportHtml += `
                <div style="margin-top: 2rem; padding: 1rem; background: ${statusColor}; color: white; border-radius: 6px; text-align: center;">
                    <h3>Overall Status: ${overallStatus}</h3>
                    <p>Performance score: ${passCount}/${testCount} tests passed</p>
                </div>
            `;
            
            resultsDiv.innerHTML = reportHtml;
            updateProgress();
            
            log(`Performance report generated: ${passCount}/${testCount} tests passed`);
        }

        function exportResults() {
            const exportData = {
                timestamp: new Date().toISOString(),
                deviceInfo: testState.deviceInfo,
                results: testState.results,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ruchy-notebook-performance-${Date.now()}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('Performance results exported to JSON file');
        }

        function clearResults() {
            testState.results = {};
            document.getElementById('test-results-summary').innerHTML = 
                '<p><em>No tests run yet. Run the tests above to see results here.</em></p>';
            document.getElementById('overall-progress').style.width = '0%';
            log('Test results cleared');
        }

        function clearOutput() {
            document.getElementById('test-output').textContent = 'Output cleared.';
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            gatherDeviceInfo();
            log('Manual performance test suite ready');
            log('Run tests above to validate notebook performance on this device/browser');
        });
    </script>
</body>
</html>