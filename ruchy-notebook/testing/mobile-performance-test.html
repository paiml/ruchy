<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruchy Notebook - Mobile Performance Test</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.4;
            color: #333;
            background: #f8f9fa;
            font-size: 16px;
            overflow-x: hidden;
        }
        
        .mobile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .mobile-header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .mobile-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .test-section {
            margin: 1rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .section-header h2 {
            font-size: 1.2rem;
            color: #495057;
            margin-bottom: 0.25rem;
        }
        
        .section-content {
            padding: 1rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .test-card {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #fafafa;
        }
        
        .test-card h3 {
            font-size: 1rem;
            color: #495057;
            margin-bottom: 0.75rem;
        }
        
        .test-card p {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .mobile-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin: 0.25rem 0;
            transition: transform 0.1s;
            touch-action: manipulation;
        }
        
        .mobile-button:active {
            transform: scale(0.98);
        }
        
        .mobile-button.secondary {
            background: #6c757d;
        }
        
        .mobile-button.success {
            background: #28a745;
        }
        
        .mobile-button.danger {
            background: #dc3545;
        }
        
        .mobile-button:disabled {
            background: #6c757d;
            opacity: 0.6;
        }
        
        .metric-display {
            background: #e9ecef;
            border-radius: 6px;
            padding: 0.75rem;
            margin: 0.75rem 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
            font-size: 0.8rem;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 0.25rem 0;
        }
        
        .metric-value {
            font-weight: 600;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-pass { background: #28a745; }
        .status-fail { background: #dc3545; }
        .status-warn { background: #ffc107; }
        .status-pending { background: #6c757d; }
        
        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .device-info {
            background: #e3f2fd;
            border: 1px solid #64b5f6;
            border-radius: 6px;
            padding: 0.75rem;
            font-size: 0.85rem;
        }
        
        .device-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .quick-test-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #dee2e6;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 200;
        }
        
        .quick-test-panel.open {
            transform: translateY(0);
        }
        
        .quick-test-toggle {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 300;
            touch-action: manipulation;
        }
        
        .quick-test-toggle:active {
            transform: scale(0.95);
        }
        
        .output-console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 0.75rem;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-line;
            -webkit-overflow-scrolling: touch;
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 0.75rem;
            border-radius: 6px;
            margin: 1rem;
            font-size: 0.9rem;
        }
        
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }
        
        @media (max-width: 480px) {
            .mobile-header h1 { font-size: 1.3rem; }
            .section-header h2 { font-size: 1.1rem; }
            .test-card h3 { font-size: 0.95rem; }
            .mobile-button { padding: 0.65rem 0.85rem; }
        }
        
        @media (max-width: 360px) {
            .test-section { margin: 0.5rem; }
            .section-content { padding: 0.75rem; }
            .device-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        <h1>📱 Mobile Performance Test</h1>
        <p>Ruchy Notebook on Mobile Devices</p>
    </div>

    <div class="warning-banner">
        <strong>Mobile Optimization Test:</strong> This page tests Ruchy Notebook performance on mobile devices. Results may vary based on device capabilities and network conditions.
    </div>

    <!-- Device Information -->
    <div class="test-section">
        <div class="section-header">
            <h2>📱 Device Information</h2>
        </div>
        <div class="section-content">
            <div class="device-info">
                <div id="device-info-mobile">Loading device information...</div>
                <div class="device-grid" id="device-grid">
                    <!-- Device details populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Performance Tests -->
    <div class="test-section">
        <div class="section-header">
            <h2>⚡ Quick Performance Tests</h2>
        </div>
        <div class="section-content">
            <div class="test-grid">
                <div class="test-card">
                    <h3>🎯 Touch Responsiveness</h3>
                    <p>Test touch response time and gesture handling</p>
                    <button class="mobile-button touch-target" onclick="testTouchResponse()">Test Touch Response</button>
                    <div class="metric-display" id="touch-metrics">
                        <div class="metric-row">
                            <span>Status:</span>
                            <span class="metric-value">Ready</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>📊 Scroll Performance</h3>
                    <p>Test scrolling smoothness and frame rate</p>
                    <button class="mobile-button touch-target" onclick="testScrollPerformance()">Test Scrolling</button>
                    <div class="metric-display" id="scroll-metrics">
                        <div class="metric-row">
                            <span>Status:</span>
                            <span class="metric-value">Ready</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>🧠 Memory on Mobile</h3>
                    <p>Test memory usage patterns on mobile</p>
                    <button class="mobile-button touch-target" onclick="testMobileMemory()">Test Memory</button>
                    <div class="metric-display" id="mobile-memory-metrics">
                        <div class="metric-row">
                            <span>Status:</span>
                            <span class="metric-value">Ready</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>🔋 Battery Impact</h3>
                    <p>Monitor battery usage during testing</p>
                    <button class="mobile-button touch-target" onclick="testBatteryImpact()">Test Battery</button>
                    <div class="metric-display" id="battery-metrics">
                        <div class="metric-row">
                            <span>Status:</span>
                            <span class="metric-value">Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile-Specific Features -->
    <div class="test-section">
        <div class="section-header">
            <h2>📲 Mobile Features</h2>
        </div>
        <div class="section-content">
            <div class="test-grid">
                <div class="test-card">
                    <h3>🌐 Offline Capability</h3>
                    <p>Test Service Worker and offline functionality</p>
                    <button class="mobile-button touch-target" onclick="testOfflineCapability()">Test Offline</button>
                    <button class="mobile-button secondary touch-target" onclick="simulateOffline()">Simulate Offline</button>
                    <div class="metric-display" id="offline-metrics">
                        <div class="metric-row">
                            <span>Network:</span>
                            <span class="metric-value" id="network-status">Online</span>
                        </div>
                    </div>
                </div>

                <div class="test-card">
                    <h3>📐 Responsive Design</h3>
                    <p>Test layout adaptation to screen sizes</p>
                    <button class="mobile-button touch-target" onclick="testResponsiveLayout()">Test Layout</button>
                    <button class="mobile-button secondary touch-target" onclick="toggleOrientation()">Test Rotation</button>
                    <div class="metric-display" id="responsive-metrics">
                        <div class="metric-row">
                            <span>Orientation:</span>
                            <span class="metric-value" id="orientation">Unknown</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Notebook Interface -->
    <div class="test-section">
        <div class="section-header">
            <h2>📝 Mobile Notebook Test</h2>
        </div>
        <div class="section-content">
            <button class="mobile-button touch-target" onclick="initMobileNotebook()">Initialize Mobile Notebook</button>
            <button class="mobile-button secondary touch-target" onclick="addMobileCells()">Add Test Cells</button>
            
            <div id="mobile-notebook" style="margin-top: 1rem; min-height: 200px; border: 1px solid #dee2e6; border-radius: 6px; background: #fafafa;">
                <div style="padding: 2rem; text-align: center; color: #6c757d;">
                    Initialize notebook to start testing
                </div>
            </div>
        </div>
    </div>

    <!-- Test Results -->
    <div class="test-section">
        <div class="section-header">
            <h2>📊 Test Results</h2>
        </div>
        <div class="section-content">
            <div class="progress-container">
                <div class="progress-bar" id="mobile-progress"></div>
            </div>
            
            <button class="mobile-button success touch-target" onclick="generateMobileReport()">Generate Report</button>
            <button class="mobile-button secondary touch-target" onclick="shareMobileResults()">Share Results</button>
            
            <div id="mobile-results">
                <p style="text-align: center; color: #6c757d; margin: 2rem 0;">
                    No tests run yet. Use the buttons above to start testing.
                </p>
            </div>
        </div>
    </div>

    <!-- Debug Console -->
    <div class="test-section">
        <div class="section-header">
            <h2>🐛 Debug Console</h2>
            <button class="mobile-button secondary" onclick="clearMobileOutput()" style="width: auto; float: right; margin-top: -0.5rem;">Clear</button>
        </div>
        <div class="section-content">
            <div class="output-console" id="mobile-output">
                Mobile performance test suite loaded.
                Touch the tests above to start validation.
            </div>
        </div>
    </div>

    <!-- Quick Test Panel -->
    <div class="quick-test-panel" id="quick-test-panel">
        <h3 style="margin-bottom: 1rem;">Quick Test</h3>
        <button class="mobile-button touch-target" onclick="runAllMobileTests()">Run All Tests</button>
        <button class="mobile-button secondary touch-target" onclick="runQuickPerformanceTest()">Quick Performance</button>
        <button class="mobile-button secondary touch-target" onclick="toggleQuickPanel()">Close</button>
    </div>

    <button class="quick-test-toggle touch-target" onclick="toggleQuickPanel()">⚡</button>

    <script>
        // Mobile test state
        const mobileTestState = {
            results: {},
            touchTimes: [],
            scrollData: [],
            deviceInfo: {},
            isOffline: false,
            quickPanelOpen: false
        };

        // Utility functions
        function mobileLog(message) {
            const output = document.getElementById('mobile-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `\n[${timestamp}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }

        function updateMobileMetric(containerId, key, value) {
            const container = document.getElementById(containerId);
            const metric = container.querySelector('.metric-value');
            if (metric) {
                metric.textContent = value;
            }
            mobileTestState.results[key] = { value, timestamp: Date.now() };
        }

        function updateMobileProgress() {
            const total = 8; // Total number of mobile tests
            const completed = Object.keys(mobileTestState.results).length;
            const percentage = (completed / total) * 100;
            document.getElementById('mobile-progress').style.width = `${percentage}%`;
        }

        // Device information gathering for mobile
        function gatherMobileDeviceInfo() {
            const nav = navigator;
            const screen = window.screen;
            
            mobileTestState.deviceInfo = {
                userAgent: nav.userAgent,
                platform: nav.platform,
                screenWidth: screen.width,
                screenHeight: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight,
                pixelRatio: window.devicePixelRatio,
                orientation: screen.orientation ? screen.orientation.angle : 'unknown',
                touchSupport: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
                deviceMemory: nav.deviceMemory || 'unknown',
                connection: nav.connection ? {
                    effectiveType: nav.connection.effectiveType,
                    downlink: nav.connection.downlink,
                    rtt: nav.connection.rtt,
                    saveData: nav.connection.saveData
                } : null,
                battery: null // Will be populated if available
            };

            // Get battery info if available
            if (nav.getBattery) {
                nav.getBattery().then(battery => {
                    mobileTestState.deviceInfo.battery = {
                        charging: battery.charging,
                        level: Math.round(battery.level * 100),
                        dischargingTime: battery.dischargingTime,
                        chargingTime: battery.chargingTime
                    };
                    updateBatteryDisplay();
                });
            }

            updateMobileDeviceDisplay();
            mobileLog('Mobile device information gathered');
        }

        function updateMobileDeviceDisplay() {
            const info = mobileTestState.deviceInfo;
            const deviceType = getMobileDeviceType();
            
            document.getElementById('device-info-mobile').textContent = 
                `${deviceType} - ${info.screenWidth}×${info.screenHeight} (${info.pixelRatio}x DPI)`;
            
            const grid = document.getElementById('device-grid');
            grid.innerHTML = `
                <div><strong>Type:</strong> ${deviceType}</div>
                <div><strong>Touch:</strong> ${info.touchSupport ? 'Yes' : 'No'}</div>
                <div><strong>Memory:</strong> ${info.deviceMemory}GB</div>
                <div><strong>Connection:</strong> ${info.connection ? info.connection.effectiveType : 'Unknown'}</div>
                <div><strong>Orientation:</strong> ${info.orientation}°</div>
                <div><strong>Available:</strong> ${info.availWidth}×${info.availHeight}</div>
            `;
            
            document.getElementById('orientation').textContent = info.orientation + '°';
        }

        function getMobileDeviceType() {
            const ua = navigator.userAgent;
            if (/iPad/.test(ua)) return 'iPad';
            if (/iPhone/.test(ua)) return 'iPhone';
            if (/Android.*Mobile/.test(ua)) return 'Android Phone';
            if (/Android/.test(ua)) return 'Android Tablet';
            if (/Windows Phone/.test(ua)) return 'Windows Phone';
            return 'Mobile Device';
        }

        function updateBatteryDisplay() {
            if (mobileTestState.deviceInfo.battery) {
                const battery = mobileTestState.deviceInfo.battery;
                const batteryMetrics = document.getElementById('battery-metrics');
                if (batteryMetrics) {
                    batteryMetrics.innerHTML = `
                        <div class="metric-row">
                            <span>Level:</span>
                            <span class="metric-value">${battery.level}%</span>
                        </div>
                        <div class="metric-row">
                            <span>Charging:</span>
                            <span class="metric-value">${battery.charging ? 'Yes' : 'No'}</span>
                        </div>
                    `;
                }
            }
        }

        // Mobile-specific tests
        function testTouchResponse() {
            mobileLog('Testing touch responsiveness...');
            updateMobileMetric('touch-metrics', 'touchTest', 'Testing...');
            
            const startTime = performance.now();
            let touchCount = 0;
            const touchTimes = [];
            
            // Create touch test overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 1000;
                display: flex; align-items: center; justify-content: center;
                flex-direction: column; color: white;
            `;
            overlay.innerHTML = `
                <h2>Touch Test</h2>
                <p>Tap the screen quickly 10 times</p>
                <p style="font-size: 2rem; margin: 1rem;">${touchCount}/10</p>
                <button onclick="this.parentElement.remove(); updateMobileMetric('touch-metrics', 'touchTest', 'Cancelled')" 
                        style="margin-top: 2rem; padding: 1rem 2rem; font-size: 1rem;">Cancel</button>
            `;
            
            overlay.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touchTime = performance.now();
                touchTimes.push(touchTime - startTime);
                touchCount++;
                
                const counter = overlay.querySelector('p:last-of-type');
                counter.textContent = `${touchCount}/10`;
                
                if (touchCount >= 10) {
                    const avgResponseTime = touchTimes.reduce((a, b) => a + b, 0) / touchTimes.length;
                    const result = avgResponseTime < 100 ? 'Excellent' : avgResponseTime < 200 ? 'Good' : 'Needs Improvement';
                    
                    updateMobileMetric('touch-metrics', 'touchTest', `${result} (${avgResponseTime.toFixed(1)}ms avg)`);
                    mobileLog(`Touch test completed: ${avgResponseTime.toFixed(1)}ms average response time`);
                    updateMobileProgress();
                    
                    overlay.remove();
                }
            }, { passive: false });
            
            document.body.appendChild(overlay);
        }

        function testScrollPerformance() {
            mobileLog('Testing scroll performance...');
            updateMobileMetric('scroll-metrics', 'scrollTest', 'Preparing...');
            
            // Create scroll test content
            const scrollContainer = document.createElement('div');
            scrollContainer.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: white; z-index: 1000; overflow-y: scroll;
                -webkit-overflow-scrolling: touch;
            `;
            
            // Generate test content
            let content = `
                <div style="padding: 2rem;">
                    <h2>Scroll Performance Test</h2>
                    <p>Scroll up and down quickly to test performance</p>
                    <button onclick="finishScrollTest()" style="padding: 1rem 2rem; margin: 1rem 0; font-size: 1rem;">Finish Test</button>
                </div>
            `;
            
            for (let i = 0; i < 100; i++) {
                content += `
                    <div style="padding: 1rem; margin: 0.5rem; background: #f8f9fa; border-radius: 8px;">
                        <h3>Test Item ${i + 1}</h3>
                        <p>This is test content for scroll performance testing. Item number ${i + 1} of 100.</p>
                    </div>
                `;
            }
            
            scrollContainer.innerHTML = content;
            
            let lastScrollTime = performance.now();
            let scrollEvents = 0;
            let scrollTimes = [];
            
            scrollContainer.addEventListener('scroll', () => {
                const now = performance.now();
                scrollTimes.push(now - lastScrollTime);
                lastScrollTime = now;
                scrollEvents++;
            }, { passive: true });
            
            // Finish scroll test function
            window.finishScrollTest = () => {
                const avgScrollTime = scrollTimes.length > 0 ? 
                    scrollTimes.reduce((a, b) => a + b, 0) / scrollTimes.length : 0;
                
                const result = avgScrollTime < 16.67 ? 'Smooth (60fps)' : 
                             avgScrollTime < 33.33 ? 'Good (30fps)' : 'Choppy';
                
                updateMobileMetric('scroll-metrics', 'scrollTest', `${result} (${avgScrollTime.toFixed(1)}ms)`);
                mobileLog(`Scroll test: ${scrollEvents} events, ${avgScrollTime.toFixed(1)}ms average frame time`);
                updateMobileProgress();
                
                scrollContainer.remove();
                delete window.finishScrollTest;
            };
            
            document.body.appendChild(scrollContainer);
            updateMobileMetric('scroll-metrics', 'scrollTest', 'Scroll to test...');
        }

        function testMobileMemory() {
            mobileLog('Testing mobile memory usage...');
            updateMobileMetric('mobile-memory-metrics', 'mobileMemory', 'Testing...');
            
            const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            const testData = [];
            
            // Create memory-intensive operations for mobile
            for (let i = 0; i < 5000; i++) { // Reduced from desktop version
                testData.push({
                    id: i,
                    content: `Mobile test data ${i}`.repeat(50), // Smaller than desktop
                    timestamp: Date.now(),
                    randomData: new Array(100).fill(Math.random()) // Smaller arrays
                });
            }
            
            setTimeout(() => {
                const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                const memoryIncrease = (finalMemory - initialMemory) / 1024 / 1024;
                
                const result = memoryIncrease < 5 ? 'Excellent' : memoryIncrease < 15 ? 'Good' : 'High Usage';
                
                updateMobileMetric('mobile-memory-metrics', 'mobileMemory', 
                    `${result} (${memoryIncrease.toFixed(1)}MB)`);
                mobileLog(`Mobile memory test: ${memoryIncrease.toFixed(1)}MB increase`);
                updateMobileProgress();
                
                // Cleanup
                testData.length = 0;
            }, 1000);
        }

        function testBatteryImpact() {
            mobileLog('Testing battery impact...');
            updateMobileMetric('battery-metrics', 'batteryTest', 'Testing...');
            
            if (!navigator.getBattery) {
                updateMobileMetric('battery-metrics', 'batteryTest', 'Not supported');
                mobileLog('Battery API not supported on this device');
                return;
            }
            
            navigator.getBattery().then(battery => {
                const initialLevel = battery.level;
                const startTime = Date.now();
                
                // Simulate intensive operations
                const intensiveTask = () => {
                    const data = [];
                    for (let i = 0; i < 10000; i++) {
                        data.push(Math.sin(Math.random() * Math.PI) * Math.cos(Math.random() * Math.PI));
                    }
                    return data.reduce((a, b) => a + b, 0);
                };
                
                const interval = setInterval(() => {
                    intensiveTask();
                }, 100);
                
                setTimeout(() => {
                    clearInterval(interval);
                    const finalLevel = battery.level;
                    const testDuration = (Date.now() - startTime) / 1000;
                    const levelChange = ((initialLevel - finalLevel) * 100).toFixed(2);
                    
                    updateMobileMetric('battery-metrics', 'batteryTest', 
                        `${levelChange}% in ${testDuration}s`);
                    mobileLog(`Battery test: ${levelChange}% change over ${testDuration} seconds`);
                    updateMobileProgress();
                }, 5000);
            });
        }

        function testOfflineCapability() {
            mobileLog('Testing offline capability...');
            updateMobileMetric('offline-metrics', 'offlineTest', 'Testing...');
            
            // Test Service Worker registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('../js/sw.js')
                    .then(registration => {
                        mobileLog('Service Worker registered successfully');
                        updateMobileMetric('offline-metrics', 'offlineTest', 'Service Worker OK');
                    })
                    .catch(error => {
                        mobileLog('Service Worker registration failed: ' + error.message);
                        updateMobileMetric('offline-metrics', 'offlineTest', 'Service Worker Failed');
                    });
            } else {
                updateMobileMetric('offline-metrics', 'offlineTest', 'Not supported');
                mobileLog('Service Workers not supported on this device');
            }
            
            updateMobileProgress();
        }

        function simulateOffline() {
            mobileTestState.isOffline = !mobileTestState.isOffline;
            document.getElementById('network-status').textContent = 
                mobileTestState.isOffline ? 'Offline (Simulated)' : 'Online';
            mobileLog(`Network status: ${mobileTestState.isOffline ? 'Offline' : 'Online'}`);
        }

        function testResponsiveLayout() {
            mobileLog('Testing responsive layout...');
            updateMobileMetric('responsive-metrics', 'responsiveTest', 'Testing...');
            
            const viewport = {
                width: window.innerWidth,
                height: window.innerHeight,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight
            };
            
            const isPortrait = viewport.height > viewport.width;
            const aspectRatio = (viewport.width / viewport.height).toFixed(2);
            
            updateMobileMetric('responsive-metrics', 'responsiveTest', 
                `${isPortrait ? 'Portrait' : 'Landscape'} ${aspectRatio}`);
            mobileLog(`Layout test: ${viewport.width}×${viewport.height}, aspect ratio ${aspectRatio}`);
            updateMobileProgress();
        }

        function toggleOrientation() {
            if (screen.orientation && screen.orientation.lock) {
                const currentType = screen.orientation.type;
                const newType = currentType.includes('portrait') ? 'landscape' : 'portrait';
                
                screen.orientation.lock(newType)
                    .then(() => mobileLog(`Orientation locked to ${newType}`))
                    .catch(error => mobileLog(`Orientation lock failed: ${error.message}`));
            } else {
                mobileLog('Screen orientation API not supported');
            }
        }

        // Mobile notebook interface
        function initMobileNotebook() {
            mobileLog('Initializing mobile notebook interface...');
            
            const container = document.getElementById('mobile-notebook');
            container.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 6px; padding: 0.75rem; margin-bottom: 1rem; font-size: 0.9rem;">
                        <strong>Mobile Notebook Interface</strong>
                        <p style="margin: 0.5rem 0 0 0;">Optimized for touch interaction and mobile screens.</p>
                    </div>
                    <div id="mobile-cells"></div>
                </div>
            `;
            
            mobileLog('Mobile notebook interface ready');
        }

        function addMobileCells() {
            const cellsContainer = document.getElementById('mobile-cells');
            if (!cellsContainer) {
                mobileLog('Initialize notebook first');
                return;
            }
            
            const cellCount = cellsContainer.children.length + 1;
            
            const cell = document.createElement('div');
            cell.style.cssText = `
                border: 1px solid #dee2e6; border-radius: 8px; margin: 1rem 0; 
                background: white; overflow: hidden;
            `;
            cell.innerHTML = `
                <div style="background: #f8f9fa; padding: 0.75rem; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 500; font-size: 0.9rem;">Mobile Cell ${cellCount}</span>
                    <button onclick="this.closest('div').closest('div').remove()" 
                            style="background: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">×</button>
                </div>
                <div style="padding: 1rem;">
                    <textarea placeholder="Enter code..." 
                              style="width: 100%; height: 80px; border: 1px solid #dee2e6; border-radius: 6px; padding: 0.75rem; font-family: monospace; font-size: 0.9rem; resize: vertical;">println("Mobile cell ${cellCount}");</textarea>
                    <button onclick="executeMobileCell(this)" 
                            class="mobile-button touch-target" 
                            style="margin-top: 0.75rem;">▶ Run Cell</button>
                    <div class="mobile-output" style="background: #f8f9fa; border-radius: 6px; margin-top: 0.75rem; padding: 0.75rem; font-family: monospace; font-size: 0.8rem; display: none;"></div>
                </div>
            `;
            
            cellsContainer.appendChild(cell);
            mobileLog(`Added mobile cell ${cellCount}`);
        }

        function executeMobileCell(button) {
            const cell = button.closest('div');
            const textarea = cell.querySelector('textarea');
            const output = cell.querySelector('.mobile-output');
            
            button.textContent = '⏳ Running...';
            button.disabled = true;
            
            setTimeout(() => {
                const executionTime = (Math.random() * 80 + 20).toFixed(1);
                output.textContent = `Output: ${textarea.value}\nExecution time: ${executionTime}ms\n✓ Completed`;
                output.style.display = 'block';
                button.textContent = '▶ Run Cell';
                button.disabled = false;
                
                mobileLog(`Mobile cell executed in ${executionTime}ms`);
            }, 500 + Math.random() * 1000);
        }

        // Quick test panel
        function toggleQuickPanel() {
            mobileTestState.quickPanelOpen = !mobileTestState.quickPanelOpen;
            const panel = document.getElementById('quick-test-panel');
            panel.classList.toggle('open', mobileTestState.quickPanelOpen);
            
            const toggle = document.querySelector('.quick-test-toggle');
            toggle.textContent = mobileTestState.quickPanelOpen ? '✕' : '⚡';
        }

        function runAllMobileTests() {
            mobileLog('Running all mobile tests...');
            toggleQuickPanel();
            
            const tests = [
                testTouchResponse,
                testMobileMemory,
                testOfflineCapability,
                testResponsiveLayout
            ];
            
            tests.forEach((test, index) => {
                setTimeout(() => test(), index * 2000);
            });
        }

        function runQuickPerformanceTest() {
            mobileLog('Running quick performance test...');
            toggleQuickPanel();
            
            const start = performance.now();
            let operations = 0;
            
            const perfTest = () => {
                for (let i = 0; i < 10000; i++) {
                    Math.sin(Math.random() * Math.PI);
                    operations++;
                }
                
                if (operations < 100000) {
                    requestAnimationFrame(perfTest);
                } else {
                    const duration = performance.now() - start;
                    const opsPerSecond = Math.round(operations / (duration / 1000));
                    mobileLog(`Quick perf test: ${opsPerSecond.toLocaleString()} ops/sec`);
                }
            };
            
            requestAnimationFrame(perfTest);
        }

        // Results and reporting
        function generateMobileReport() {
            mobileLog('Generating mobile performance report...');
            
            const results = document.getElementById('mobile-results');
            const timestamp = new Date().toLocaleString();
            const deviceType = getMobileDeviceType();
            
            let reportHtml = `
                <h3 style="margin: 1rem 0;">Mobile Performance Report</h3>
                <div style="background: #f8f9fa; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                    <div style="font-size: 0.9rem; color: #495057;">
                        <strong>Generated:</strong> ${timestamp}<br>
                        <strong>Device:</strong> ${deviceType}<br>
                        <strong>Screen:</strong> ${mobileTestState.deviceInfo.screenWidth}×${mobileTestState.deviceInfo.screenHeight}<br>
                        <strong>Connection:</strong> ${mobileTestState.deviceInfo.connection ? mobileTestState.deviceInfo.connection.effectiveType : 'Unknown'}
                    </div>
                </div>
                <div style="margin: 1rem 0;">
            `;
            
            const testResults = Object.entries(mobileTestState.results);
            testResults.forEach(([test, result]) => {
                reportHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                        <span style="font-weight: 500;">${test}:</span>
                        <span style="color: #495057;">${result.value}</span>
                    </div>
                `;
            });
            
            reportHtml += '</div>';
            
            const score = Math.min(100, (testResults.length / 8) * 100);
            reportHtml += `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-top: 1rem;">
                    <h4>Mobile Performance Score</h4>
                    <div style="font-size: 2rem; font-weight: bold;">${score.toFixed(0)}%</div>
                    <div>Tests Completed: ${testResults.length}/8</div>
                </div>
            `;
            
            results.innerHTML = reportHtml;
            mobileLog('Mobile performance report generated');
        }

        function shareMobileResults() {
            if (navigator.share) {
                const resultData = {
                    title: 'Ruchy Notebook Mobile Performance Results',
                    text: `Mobile performance test completed on ${getMobileDeviceType()}. ${Object.keys(mobileTestState.results).length}/8 tests passed.`,
                    url: window.location.href
                };
                
                navigator.share(resultData)
                    .then(() => mobileLog('Results shared successfully'))
                    .catch(error => mobileLog('Share failed: ' + error.message));
            } else {
                // Fallback to copying to clipboard
                const results = JSON.stringify({
                    timestamp: new Date().toISOString(),
                    device: getMobileDeviceType(),
                    results: mobileTestState.results
                }, null, 2);
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(results)
                        .then(() => mobileLog('Results copied to clipboard'))
                        .catch(error => mobileLog('Copy failed: ' + error.message));
                } else {
                    mobileLog('Sharing not supported on this device');
                }
            }
        }

        function clearMobileOutput() {
            document.getElementById('mobile-output').textContent = 'Console cleared.';
        }

        // Initialize mobile test suite
        window.addEventListener('load', () => {
            gatherMobileDeviceInfo();
            mobileLog('Mobile performance test suite ready');
            
            // Listen for orientation changes
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    gatherMobileDeviceInfo();
                    mobileLog('Orientation changed, device info updated');
                }, 500);
            });
            
            // Listen for online/offline events
            window.addEventListener('online', () => {
                if (!mobileTestState.isOffline) {
                    document.getElementById('network-status').textContent = 'Online';
                    mobileLog('Network: Back online');
                }
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('network-status').textContent = 'Offline';
                mobileLog('Network: Gone offline');
            });
        });

        // Prevent zoom on double tap for better test experience
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>